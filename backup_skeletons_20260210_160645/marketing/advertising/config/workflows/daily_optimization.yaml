# ============================================================================
# NADAKKI AI Suite - Daily Optimization Workflow
# Automated daily optimization cycle for Google Ads
# ============================================================================

name: daily_optimization
version: "1.0"
description: "Daily optimization workflow for budget pacing and search terms cleanup"

inputs:
  tenant_id:
    type: string
    required: true
  campaign_ids:
    type: array
    required: false
  objective:
    type: string
    default: "budget_efficiency"

outputs:
  optimization_summary:
    type: object
  total_changes:
    type: integer

tags:
  - daily
  - optimization
  - automated

timeout_minutes: 30

steps:
  - name: fetch_metrics
    type: operation
    operation: get_campaign_metrics@v1
    params:
      campaign_ids: "${input.campaign_ids}"
    next_step: analyze_budget_pacing
    on_error: report_failure

  - name: analyze_budget_pacing
    type: agent
    agent: budget_pacing_agent
    agent_params:
      campaigns: "${steps.fetch_metrics.result.data.campaigns}"
    next_step: check_budget_changes
    on_error: continue_without_budget

  - name: check_budget_changes
    type: condition
    condition: "${steps.analyze_budget_pacing.result.executed} > 0"
    on_true: analyze_search_terms
    on_false: analyze_search_terms

  - name: analyze_search_terms
    type: agent
    agent: search_terms_agent
    agent_params: {}
    next_step: generate_summary
    on_error: generate_summary

  - name: generate_summary
    type: operation
    operation: generate_report@v1
    params:
      budget_changes: "${steps.analyze_budget_pacing.result}"
      search_term_changes: "${steps.analyze_search_terms.result}"
    next_step: null

  - name: continue_without_budget
    type: operation
    operation: log_event@v1
    params:
      event: "budget_pacing_skipped"
      reason: "No changes needed or error"
    next_step: analyze_search_terms

  - name: report_failure
    type: operation
    operation: log_event@v1
    params:
      event: "workflow_failure"
      step: "fetch_metrics"
    next_step: null
